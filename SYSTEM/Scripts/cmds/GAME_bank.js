module.exports = {
  config: {
    name: "Ø¨Ù†Ùƒ",
    aliases: ["bank"],
    version: "1.0",
    author: "allou Mohamed",
    countDown: 5,
    role: 0,
    shortDescription: {
      vi: "",
      en: "Ø§Ù„Ø¨Ù†Ùƒ ğŸ¦ Ù†Ø³Ø®Ø© Ø¬Ø¯ÙŠØ¯Ø©"
    },
    category: "Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨"
  },
 langs: {
   ar: {
     bank_allou_list: "â•â•â•â•ğ—¦ğ—²ğ—¿ğ˜ƒğ—¶ğ—°ğ—²ğ˜€â•â•â•â•\n%1\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
     bank_allou: "â•â•â•â•â•â•ğ—•ğ—®ğ—»ğ—¸â•â•â•â•â•â•\n%1\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
     bank_allou_bal: "â•â•â•â•â•â•ğ—•ğ—®ğ—»ğ—¸â•â•â•â•â•â•\n#balance: %1 Da\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
     login: "â•â•â•â•â•â•ğ—•ğ—®ğ—»ğ—¸â•â•â•â•â•â•\nâ€¢ØªÙ… ØªØ³Ø¬ÙŠÙ„Ùƒ ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ Ø¨Ù†Ø¬Ø§Ø­\n â€¢ Ø¥Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨:\n%1\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
     needAcc: "â•â•â•â•â•â•ğ—•ğ—®ğ—»ğ—¸â•â•â•â•â•â•\nâ€¢Ø£Ù†Øª Ù„Ù… ØªØ³Ø¬Ù„ Ø±ÙˆØ­ Ø³Ø¬Ù„ Ùˆ Ø¥Ø±Ø¬Ø¹\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
     need_money: "â•â•â•â•â•â•ğ—•ğ—®ğ—»ğ—¸â•â•â•â•â•â•\nâ€¢#Login:\n â€¢ Ø«Ù…Ù† Ø§Ù„ØªØ³Ø¬ÙŠÙ„:\n{ %1 Da }\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
     Force_Loan: "ğŸ‘®ğŸ¾â€â™‚ï¸ Ø§Ù„Ø´Ø±Ø·Ø© ÙŠØ§ Ù„Øµ !:\n%1",
     not_payed: "Ù„Ù‚Ø¯ Ø£Ø®Ø°Øª Ù‚Ø±Ø¶ ÙˆÙ„Ù… ØªØ±Ø¬Ø¹Ù‡ Ø¨Ø¹Ø¯ ğŸ˜’",
     transfer_Dm: "â•â•â•ğ—§ğ—¿ğ—®ğ—»ğ˜€ğ—³ğ—²ğ—¿â•â•â•â•â•\nâ€¢ Ø§Ù„Ø¥Ø³Ù…: %3\nâ€¢ Ø§Ù„Ù…Ø¹Ø±Ù: %1\nâ€¢ Ù…Ø¨Ù„Øº Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø­ÙˆÙ„ Ù„Ùƒ: %7 Da\nâ€¢ÙƒÙ… ÙƒØ§Ù† Ù…Ø¹Ùƒ Ø³Ø§Ø¨Ù‚Ø§: %6 Da\nâ€¢Ø¥Ø³Ù… Ø­Ø³Ø§Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ: %4\nâ€¢ Ù…Ø¹Ø±ÙÙƒ: %2\nâ€¢ ÙƒÙ… ÙƒØ§Ù† Ù…Ø¹ Ø§Ù„Ø°ÙŠ Ø­ÙˆÙ„ Ù„Ùƒ: %5 Da\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
     reply_to: "Ø±Ø¯ Ø¹Ù„Ù‰ Ù…Ù† ØªØ±ÙŠØ¯ Ø£Ù† Ø£Ø­ÙˆÙ„ Ù„Ù‡ ğŸ¤¨",
     redeem_on: "â•â•â•â•ğ—¥ğ—²ğ—±ğ—²ğ—²ğ—ºğ—¢ğ—»â•â•â•â•\n%1\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
     redeem_off: "â•â•â•â•ğ—¥ğ—²ğ—±ğ—²ğ—²ğ—ºğ—¢ğ—³ğ—³â•â•â•â•\n%1\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
     old_trick: "â€¢ Ø¨Ø¯Ùƒ ØªØ­ÙˆÙ„ Ù„Ù†ÙØ³Ùƒ Ùˆ ØªØ³ÙˆÙŠ Ù…Ø¶Ø§Ø¹ÙØ© Ù†Ù‚ÙˆØ¯ ÙŠØ§ ÙƒÙ„Ø¨ ğŸŒ"
   }
 },
 atCall: async function({ usersData, threadsData, event, args, message, getLang, api }) {
   
   const services = "1: ØªØ³Ø¬ÙŠÙ„\n2: Ø¥ÙŠØ¯Ø§Ø¹\n3: Ø¹Ø±Ø¶\n4: Ø³Ø­Ø¨\n5: Ù‚Ø±Ø¶\n6: Ø³Ø¯Ø§Ù„Ù‚Ø±Ø¶\n7: ØªØ­ÙˆÙŠÙ„\n8: redeem (soon)\nâ•â•â•â•â•â•ğ—•ğ—®ğ—»ğ—¸â•â•â•â•â•â•\nâ€¢ Ø§Ù„ÙØ§Ø¦Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©: => 10 Ø±Ø³Ø§Ø¦Ù„ ØªØ­ØµÙ„ Ø¹Ù„Ù‰ ÙØ§Ø¦Ø¯Ø© 50 Da ğŸ™†â€â™‚ï¸ğŸ¤\nâ— ÙÙ‚Ø· Ù„Ù…Ù† Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ";

   const service = args[0];
   
   if (!service) return message.reply(getLang("bank_allou_list", services));
   
   const amount = parseInt(args[1]);
   const id = event.senderID;
   //////////redeem///////////
   if (["redeem"].includes(service)) {
     if (["on", "ØªØ´ØºÙŠÙ„"].includes(args[1])) {
       await threadsData.set(event.threadID, true, "settings.sendBankRedeem");
       message.reply(getLang("redeem_on","ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ âœ“"));
     }
     if (["off", "Ø¥ÙŠÙ‚Ø§Ù"].includes(args[1])) {
       await threadsData.set(event.threadID, false, "settings.sendBankRedeem");
       message.reply(getLang("redeem_off","ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙˆØ¶Ø¹ âœ“"));
     }
   }
   //////////login////////////
   if (["login", "ØªØ³Ø¬ÙŠÙ„", "Ø³Ø¬Ù„"].includes(service)) {
     const usMo = await usersData.get(id, "money") || 0;
     const HOW = 2000;

     if (usMo < HOW) return message.reply(getLang("need_money", HOW));
    
     const username = await usersData.getName(id);
     
     await usersData.set(id, true, "data.has_bank_acc");
     await usersData.subtractMoney(id, 2000);
     message.reply(getLang('login', username));
   }
   const isR = await usersData.get(id, "data.has_bank_acc");

   if (isR != true) return message.reply(getLang("needAcc"));
  
  ///////////deposit//////////
  if (["deposit", "ØªØ®Ø²ÙŠÙ†", "Ø§ÙŠØ¯Ø§Ø¹", "Ø¥ÙŠØ§Ø¯Ø¹", "ÙˆØ¶Ø¹"].includes(service)) {
    
    if (!amount) return message.reply('ÙƒÙ… ğŸ˜† ØŸ');

    const res = await dpsMoneyToBank(amount, usersData, id);
    message.reply(getLang("bank_allou", res));
  }
   /////////withdraw/////////
   if (["withdraw", "wth", "Ø³Ø­Ø¨", "Ø§Ø®Ø°", "Ø£Ø®Ø°"].includes(service)) {
    
    if (!amount) return message.reply('ÙƒÙ… ğŸ˜† ØŸ');

    const res = await wthMoneyFromBank(amount, usersData, id);
    message.reply(getLang("bank_allou", res));
      }
   ////////////bal////////
   if (["bal", "balance", "Ø¹Ø±Ø¶"].includes(service)) {
     const usB = await usersData.get(id, "data.BankBal") || 0;
     message.reply(getLang("bank_allou_bal", usB));
   }
   //////////Loan////////
   if (["Loan", "loan", "Ù‚Ø±Ø¶"].includes(service)) {
     const old = await usersData.get(id, "data.LoanSt");

     if (old == true) return message.reply(getLang("not_payed"));
     
     const Loan = 4000;
     
     const res = await addLoan(Loan, usersData, id);
     message.reply(getLang("bank_allou", res));
     
   }
   ////////////payLoan/////////
   if (["payLoan", "payloan", "Ø³Ø¯Ø§Ù„Ù‚Ø±Ø¶"].includes(service)) {
     const res = await payLoan(id, usersData);
     return message.reply(getLang("bank_allou", res));
   }

   if (["transfer", "ØªØ­ÙˆÙŠÙ„"].includes(service)) {
     

     if (event.type != "message_reply") return message.reply(getLang("reply_to"));
     
     const To = event.messageReply.senderID;

     const res = await transfer(id, To, usersData, amount, api, getLang);

     message.reply(getLang("bank_allou", res));
   }
 },
  
  atChat: async function({getLang, usersData, message, event }) {
    
    const id = event.senderID;
    const old = await usersData.get(id, "data.LoanSt");
    const isR = await usersData.get(id, "data.has_bank_acc");

    if (isR != true) return;

    await addGift(id, usersData);
    
    const res = await checkForLoan(id, usersData);

    if (!res) return;
    
    await aiGetTheLoan(id, usersData);
      message.reply(getLang("Force_Loan", res));
      

    
  }
 }

async function wthMoneyFromBank(amount, usersData, id) {
  try {
    let crrM = await usersData.get(id, "money") || 0;
    let crrBank = await usersData.get(id, "data.BankBal") || 0;

    if (isNaN(amount)) return 'â€¢ Ù…Ø³Ù…ÙˆØ­ ÙÙ‚Ø· Ø§Ù„Ø£Ø±Ù‚Ø§Ù…';

    if (amount > crrBank) return 'â€¢ Ø§Ù„Ù…Ø¨Ù„Øº ÙƒØ¨ÙŠØ± Ø¹Ù„ÙŠÙƒ ğŸ¤£';

    await usersData.set(id, crrBank - amount, "data.BankBal");
    await usersData.addMoney(id, amount);

    return `â€¢ ØªÙ… Ø³Ø­Ø¨ ${amount} Da Ù…Ù† Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ùˆ Ù‡ÙŠ Ø§Ù„Ø¢Ù† ÙÙŠ Ø±ØµÙŠØ¯Ùƒ`;

  } catch (error) {
    console.error(error.message);
    return error.message;
  }
  }


async function dpsMoneyToBank(amount, usersData, id) {
  try {
    if (isNaN(amount)) return 'â€¢ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ÙÙ‚Ø·';

    
    let crrBank = await usersData.get(id, "data.BankBal") || 0;

    let crrM = await usersData.get(id, "money") || 0;
    
    if (amount > crrM) return 'â€¢ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¨Ù„Øº';
    
    let newBankBalance = crrBank + amount;

    await usersData.set(id, newBankBalance, "data.BankBal");
    await usersData.subtractMoney(id, amount);

    return `â€¢ØªÙ… Ø¨Ù†Ø¬Ø§Ø­ Ø¥ÙŠØ¯Ø§Ø¹ ${amount} Da ÙÙŠ Ø­Ø³Ø§Ø¨Ùƒ.`; 

  } catch (error) {
    console.error(error.message);
    
    return `â€¢ Ø­Ø¯Ø« Ø®Ø·Ø£: \n${error.message}`; 
  }
}

async function addLoan(amount, usersData, id) {
  
  let crrBank = await usersData.get(id, "data.BankBal") || 0;

  await usersData.set(id, crrBank + amount, "data.BankBal");

  await usersData.set(id, Date.now(), "data.LoanDate");

  await usersData.set(id, true, "data.LoanSt");

  
  
  return `â€¢ Ù„Ù‚Ø¯ ØªÙ… Ø¥Ø¹Ø·Ø§Ø¦Ùƒ Ù‚Ø±Ø¶ Ø¨Ù‚ÙŠÙ…Ø© ${amount}\nğŸ“ Ø³ÙŠØªÙ… Ø¹Ù‚Ø§Ø¨Ùƒ Ø¥Ø°Ø§ Ù„Ù… ØªØ¯ÙØ¹Ù‡ ÙÙŠ 4 Ø³Ø§Ø¹Ø§Øª ğŸ‘¾ Ù…Ø´ Ù…Ø²Ø­`;
}

async function checkForLoan(id, usersData) {
  
  const firstLoan = await usersData.get(id, "data.LoanDate");
  const old = await usersData.get(id, "data.LoanSt");
  
  if (!old) return;
  
const currentTime = Date.now();

const byAllouMohamed = 4 * 3600000;


   if (currentTime - firstLoan > byAllouMohamed) {
     return 'â€¢ ØªÙ… Ø£Ø®Ø° Ø§Ù„Ù‚Ø±Ø¶ Ø§Ù„Ø°ÙŠ Ù„Ù… ØªØ¯ÙØ¹ Ø«Ù…Ù†Ù‡ Ù…Ù† Ø±ØµÙŠØ¯Ùƒ Ø£Ùˆ Ø£ÙƒØ«Ø± Ø´ÙˆÙŠ ğŸ˜ˆ Ù„Ù‚Ø¯ Ù‚Ù„Øª Ù„Ùƒ Ø³ØªØ¹Ø§Ù‚Ø¨ Ø¨Ø¹Ø¯ Ø£Ø±Ø¨Ø¹ Ø³Ø§Ø¹Ø§Øª...';  
   } else {
     return false;
   }
}

async function aiGetTheLoan(id, usersData) {
  
  await usersData.set(id, 0, "data.BankBal");
  await usersData.set(id, null, "data.LoanDate");
  await usersData.set(id, false, "data.LoanSt");

  return true;
  
} 
async function payLoan(id, usersData) {
   const crrM = await usersData.get(id, "money") || 0;
   if (crrM < 4000) return 'â€¢ Ù„Ø§ ØªÙ…Ù„Ùƒ Ø§Ù„Ù…Ø§Ù„ Ø§Ù„ÙƒØ§ÙÙŠ Ù…Ø¹Ùƒ (ÙÙŠ Ø±ØµÙŠØ¯Ùƒ Ù„ÙŠØ³ ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ)';

   await usersData.subtractMoney(id, 4000);
 
   await usersData.set(id, false, "data.LoanSt");

  await usersData.set(id, null, "data.LoanDate");
    
    
  
  return 'â€¢ ØªÙ… Ø³Ø¯ Ø§Ù„Ù‚Ø±Ø¶ Ù…Ù† Ø±ØµÙŠØ¯Ùƒ Ù…Ù…ØªØ§Ø² âœ“';
}

async function transfer(From, To, usersData, amount, api, getLang) {

   if (From == To) return getLang("old_trick");
  
   const FcrrBank = await usersData.get(From, "data.BankBal") || 0;

   const TcrrBank = await usersData.get(To, "data.BankBal") || 0;

   const Tname = await usersData.getName(To);

   const Fname = await usersData.getName(From);

   if (isNaN(amount) || amount < 1000) return 'â€¢ Ø§Ù„Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† 1000 Da';
  
   if (amount > FcrrBank) return 'â€¢ Ø§Ù„Ù…Ø¨Ù„Øº Ø£Ù‚Ù„ Ù…Ù† Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø¨Ù†ÙƒÙŠ ğŸ˜¹';

   await usersData.set(From, FcrrBank - amount, "data.BankBal");

   await usersData.set(To, TcrrBank + amount, "data.BankBal");
  
   api.sendMessage(getLang("transfer_Dm", From, To, Fname, Tname, FcrrBank, TcrrBank, amount), To);

  return 'â€¢ ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­'
   
}

async function addGift(id, usersData) {
  
  const crrBank = await usersData.get(id, "data.BankBal") || 0;

  await usersData.set(id, crrBank + 5, "data.BankBal");

  return; /*console.log('added gift ğŸ');*/

}



 