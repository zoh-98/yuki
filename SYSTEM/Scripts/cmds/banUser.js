const { getTime } = global.utils;

module.exports = {
	config: {
		name: "Ù…Ø³ØªØ®Ø¯Ù…",
		version: "1.3",
		author: "Allou Mohamed",
		countDown: 5,
		role: 2,
		shortDescription: "Ø­Ø¶Ø± Ù…Ù† Ø§Ù„Ø¨ÙˆØª",
		category: "Ø§Ù„Ù…Ø·ÙˆØ±",
		guide: "Ø¨Ø§Ù† | ÙÙƒ => Ù…Ø¹Ø±Ù | Ø³Ø¨Ø¨",
    usePrefix: true
	},

	langs: {
    ar: {
        noUserFound: "âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø°ÙŠ ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©: \"%1\" ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨ÙˆØª",
        userFound: "ğŸ” ÙˆØ¬Ø¯ %1 Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø°ÙŠ ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© \"%2\" ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨ÙˆØª:\n%3",
        uidRequired: "Uid Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙ… Ø­Ø¸Ø±Ù‡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ§Ø±ØºÙ‹Ø§ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Uid Ø£Ùˆ ÙˆØ³Ù… Ø£Ùˆ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… 'user ban <uid> <reason>'",
        reasonRequired: "Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ±Ùƒ Ø³Ø¨Ø¨ Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙØ§Ø±ØºÙ‹Ø§ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Uid Ø£Ùˆ ÙˆØ³Ù… Ø£Ùˆ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… 'user ban <uid> <reason>'",
        userHasBanned: "ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ [%1 | %2] Ù…Ù† Ù‚Ø¨Ù„:\nÂ» Ø§Ù„Ø³Ø¨Ø¨: %3\nÂ» Ø§Ù„ØªØ§Ø±ÙŠØ®: %4",
        userBanned: "ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ [%1 | %2]:\nÂ» Ø§Ù„Ø³Ø¨Ø¨: %3\nÂ» Ø§Ù„ØªØ§Ø±ÙŠØ®: %4",
        uidRequiredUnban: "Uid Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙ… Ø±ÙØ¹ Ø­Ø¸Ø±Ù‡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ§Ø±ØºÙ‹Ø§",
        userNotBanned: "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ [%1 | %2] ØºÙŠØ± Ù…Ø­Ø¸ÙˆØ±",
        userUnbanned: "ØªÙ… Ø±ÙØ¹ Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ [%1 | %2]"
    }
	},

	atCall: async function ({ args, usersData, message, event, prefix, getLang }) {
		const type = args[0];
		switch (type) {
			// find user
			case "Ø¨Ø­Ø«":
			case "-f":
			case "search":
			case "-s": {
				const allUser = await usersData.getAll();
				const keyWord = args.slice(1).join(" ");
				const result = allUser.filter(item => (item.name || "").toLowerCase().includes(keyWord.toLowerCase()));
				const msg = result.reduce((i, user) => i += `\nâ€¢ Ø§Ù„Ø¥Ø³Ù…: ${user.name}\nâ€¢ Ø§Ù„Ù…Ø¹Ø±Ù: ${user.userID}`, "");
				message.reply(result.length == 0 ? getLang("noUserFound", keyWord) : getLang("userFound", result.length, keyWord, msg));
				break;
			}
			// ban user
			case "ban":
			case "Ø¨Ø§Ù†": {
				let uid, reason;
				if (event.type == "message_reply") {
					uid = event.messageReply.senderID;
					reason = args.slice(1).join(" ");
				}
				else if (Object.keys(event.mentions).length > 0) {
					const { mentions } = event;
					uid = Object.keys(mentions)[0];
					reason = args.slice(1).join(" ").replace(mentions[uid], "");
				}
				else if (args[1]) {
					uid = args[1];
					reason = args.slice(2).join(" ");
				}
				else return message.SyntaxError();

				if (!uid)
					return message.reply(getLang("uidRequired"));
				if (!reason)
					return message.reply(getLang("reasonRequired", prefix));
				reason = reason.replace(/\s+/g, ' ');

				const userData = await usersData.get(uid);
				const name = userData.name;
				const status = userData.banned.status;

				if (status)
					return message.reply(getLang("userHasBanned", uid, name, userData.banned.reason, userData.banned.date));
				const time = getTime("DD/MM/YYYY HH:mm:ss");
				await usersData.set(uid, {
					banned: {
						status: true,
						reason,
						date: time
					}
				});
				message.reply(getLang("userBanned", uid, name, reason, time));
				break;
			}
			// unban user
			case "unban":
			case "ÙÙƒ": {
				let uid;
				if (event.type == "message_reply") {
					uid = event.messageReply.senderID;
				}
				else if (Object.keys(event.mentions).length > 0) {
					const { mentions } = event;
					uid = Object.keys(mentions)[0];
				}
				else if (args[1]) {
					uid = args[1];
				}
				else
					return message.SyntaxError();
				if (!uid)
					return message.reply(getLang("uidRequiredUnban"));
				const userData = await usersData.get(uid);
				const name = userData.name;
				const status = userData.banned.status;
				if (!status)
					return message.reply(getLang("userNotBanned", uid, name));
				await usersData.set(uid, {
					banned: {}
				});
				message.reply(getLang("userUnbanned", uid, name));
				break;
			}
			default:
				return message.reply('Ø¨Ø§Ù† Ø£Ùˆ ÙÙƒ + Ø¥Ø°Ø§ Ø¨Ø§Ù† Ø±Ø¯ Ø¹Ø´Ø®Øµ Ø£Ùˆ Ø­Ø· Ù…Ø¹Ø±ÙÙ‡ Ù…Ø¹ Ø§Ù„Ø³Ø¨Ø¨');
		}
	}
};